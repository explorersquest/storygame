<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>F√ºr Luisa üå∏</title>
<style>
/* START OVERLAY */
#startOverlay {
  position: fixed;
  inset: 0;
  background: rgba(5, 5, 15, 0.6);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.8s ease;
}

/* Start Button */
#startBtn {
  padding: 20px 60px;
  font-size: 28px;
  border-radius: 18px;
  border: none;
  cursor: pointer;
  font-weight: bold;
  color: #ffd700;
  background: linear-gradient(145deg, #6655aa, #444477);
  box-shadow: 0 0 25px rgba(255,215,0,0.4);
  text-shadow: 0 0 8px #ffd700;
  transition: transform 0.2s, box-shadow 0.2s;
}

#startBtn:hover {
  transform: scale(1.08);
  box-shadow: 0 0 40px rgba(255,215,0,0.6);
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'Georgia', serif;
  color: #f5f5f5;
  background: radial-gradient(circle at top, #0a0a0a, #1a1a2e); 
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* Gl√ºhender Titel */
h1 { 
  color: #ffd700; 
  text-shadow: 0 0 10px #ffd700, 0 0 20px #ffb347;
  font-size: 3em;
  margin-bottom: 32px;
  text-align: center;
}
h2 { 
  color: #ffd700; 
  text-shadow: 0 0 10px #ffd700, 0 0 20px #ffb347;
  font-size: 2.5em;
  margin-bottom: 16px;
  text-align: center;
}

/* Hauptmen√º */
#mainMenu {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 25px;
}
#mainMenu button { 
  background: linear-gradient(145deg, #6655aa, #444477);
  border: none;
  padding: 20px 40px;
  border-radius: 15px;
  color: #ffd700;
  font-size: 22px;
  font-weight: bold;
  cursor: pointer;
  text-shadow: 0 0 5px #ffd700;
  transition: transform 0.15s, background 0.2s;
}
#mainMenu button:hover { 
  background: linear-gradient(145deg, #7777cc, #5555aa); 
  transform: scale(1.08);
}

/* Spielcontainer */
#gameContainer {
  flex: 1;
  display: none; /* wird erst sichtbar beim Spielstart */
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}

/* Akt / Szene Label */
#sceneLabel {
  font-size: 24px;
  margin-bottom: 20px;
  color: #ffdd77;
  text-shadow: 0 0 5px #ffd700;
}

/* Textbox */
#sceneText {
  display: none; /* erst sichtbar, wenn Animation startet */
  margin: 20px auto; 
  max-width: 80%;
  padding: 30px; 
  background: rgba(30,30,50,0.85); 
  border-radius: 15px; 
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); 
  font-size: 20px; 
  min-height: 180px;
  white-space: pre-wrap;
}

/* Buttons nebeneinander unten */
#choices {
  display: flex;
  justify-content: center;
  margin-top: 30px;
  gap: 20px;
  visibility: hidden; /* erst nach Tippen sichtbar */
}
#choices button { 
  flex: 1 1 150px;
  max-width: 250px;
  padding: 15px 0;
  border-radius: 12px;
  background: #444477; 
  color: #ffd700; 
  font-weight: bold;
  font-size: 18px;
  border: none;
  cursor: pointer;
  transition: transform 0.1s, background 0.2s;
}
#choices button:hover { background:#6655aa; transform: scale(1.05); }

#commentLabel {
  margin-top: 4px;
  font-size: 11px;
  color: #888;
  transform: rotate(-6deg);
  opacity: 0.75;
  letter-spacing: 1px;
  user-select: none;
}

/* Sterne mit leichter Bewegung */
.star {
  position: absolute;
  width: 2px; 
  height: 2px; 
  background: white; 
  border-radius: 50%;
  opacity: 0.8;
  animation: twinkle 2s infinite alternate, floatStars 6s infinite alternate;
}
@keyframes twinkle { 0% {opacity:0.3;} 100% {opacity:1;} }
@keyframes floatStars {
  0% { transform: translate(0px,0px);}
  50% { transform: translate(1.5px, -1.5px);}
  100% { transform: translate(0px,0px);}
}
/* Sternschnuppe */
.shooting-star {
  position: absolute;
  width: 2px;
  height: 2px;
  background: white;
  border-radius: 50%;
  opacity: 0.9;
  pointer-events: none;
  transform: rotate(-45deg); /* Flugrichtung */
}

/* Schweif ‚Äì exakt in Flugrichtung */
.shooting-star::after {
  content: '';
  position: absolute;
  top: 0;
  left: -60px;
  width: 60px;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8));
}

/* Langsame, weiche Flugbewegung */
@keyframes shoot {
  from {
    transform: translate(0, 0) rotate(-45deg);
    opacity: 1;
  }
  to {
    transform: translate(-900px, 900px) rotate(-45deg);
    opacity: 0;
  }
}

/* Chat-UI */
#chatContainer {
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  width:80%;
  max-width:600px;
  margin:0 auto;
  background: rgba(30,30,50,0.85);
  border-radius:15px;
  padding:20px;
  min-height:400px;
}
/* Eigene Nachrichten */
.myMessage {
  background: rgba(0, 120, 255, 0.15);
  color: #4db8ff;
  padding: 8px 12px;
  margin: 5px 0;
  border-radius: 12px;
  box-shadow: 0 0 8px #4db8ff, 0 0 16px #00aaff80;
  max-width: 80%;
  align-self: flex-end;
  word-wrap: break-word;
}

/* Luisas Nachrichten */
.theirMessage {
  background: rgba(255, 77, 192, 0.15);
  color: #ff77cc;
  padding: 8px 12px;
  margin: 5px 0;
  border-radius: 12px;
  box-shadow: 0 0 8px #ff77cc, 0 0 16px #ff77cc80;
  max-width: 80%;
  align-self: flex-start;
  word-wrap: break-word;
}

#chatMessages {
  flex:1;
  overflow-y:auto;
  width:100%;
  margin-bottom:10px;
  color:#ffd700;
}
#chatInput {
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:16px;
}
#chatContainer button {
  margin-top:10px;
  padding:10px 20px;
  border-radius:8px;
  border:none;
  background:#444477;
  color:#ffd700;
  font-weight:bold;
  cursor:pointer;
}
#chatContainer button#backFromChatBtn { background:#6655aa; }
</style>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>

<div id="startOverlay">
  <button id="startBtn">Start ‚ú®</button>
</div>

<h1>F√ºr Luisa üå∏</h1>
<h2>Fr4gm3nt3</h2>

<!-- Hauptmen√º -->
<div id="mainMenu">
  <button id="newGameBtn">Neuer Spielstand</button>
  <button id="loadGameBtn">Spielstand laden</button>
  <button id="openChatBtn">Deine Gedanken</button>
  <div id="versionLabel" style="margin-top:15px; font-size:14px; color:#aaa; text-align:center;">Version 2.14.2.2</div>
  <div id="commentLabel">Kommentar</div>
</div>

<!-- Spielbereich -->
<div id="gameContainer">
  <div id="sceneLabel"></div>
  <div id="sceneText"></div>
  <div id="choices"></div>
</div>


<!-- Chatbereich -->
<div id="chatContainer">
  <h2>Deine Gedanken üåù</h2>
  <div id="chatMessages"></div>
  <input id="chatInput" type="text" placeholder="Schreibe etwas..." />
  <button id="sendChatBtn">Abschicken</button>
  <button id="backFromChatBtn">Zur√ºck</button>
</div>

<audio id="bgMusic" src="momedeiros88-mystical.mp3" type="audio/mpeg" loop></audio>
<audio id="typeSound" src="game-text.mp3" preload="auto"></audio>
<audio id="clickSound" src="magic-button-click.mp3" preload="auto"></audio>

<script>
let displayName = '';

async function initDisplayName() {
  const docSnap = await inventoryDoc.get();
  if (docSnap.exists && docSnap.data().displayName) {
    displayName = docSnap.data().displayName;
  } else {
    const name = prompt("Dein Name? üå∏") || "Unbekannt";
    displayName = name.trim();
    await inventoryDoc.set({ displayName }, { merge: true });
  }
}

/********* NORMALE STERNE *********/
for(let i=0;i<80;i++){
  const star = document.createElement('div');
  star.className = 'star';
  star.style.top = Math.random()*100+'%';
  star.style.left = Math.random()*100+'%';
  star.style.width = star.style.height = (Math.random()*2+1)+'px';
  star.style.animationDuration = (Math.random()*2+1)+'s, '+(4+Math.random()*3)+'s';
  document.body.appendChild(star);
}
/********* STERNSCHNUPPEN *********/
function spawnShootingStar(){
  const star = document.createElement('div');
  star.className = 'shooting-star';

  // Startposition: oben, leicht rechts von der Bildschirmmitte bis ganz rechts
  const startX = window.innerWidth * 0.5 + Math.random() * (window.innerWidth * 0.5);
  const startY = -Math.random() * 50; // leicht √ºber dem Bildschirm

  star.style.left = startX + 'px';
  star.style.top = startY + 'px';

  // Animationsdauer langsamer: 1.2s bis 2s
  const duration = 1.2 + Math.random() * 0.8;
  star.style.animation = `shoot ${duration}s linear forwards`;

  document.body.appendChild(star);

  // Nach Animation entfernen
  setTimeout(() => {
    star.remove();
  }, duration * 1000);
}

// Interval: alle 6‚Äì12 Sekunden, 40% Chance
setInterval(() => {
  if (Math.random() < 0.4) spawnShootingStar();
}, 6000);

/********* STORY DATA *********/ 
const story = { 
  "-1_-1": { label:"Akt -1, Szene -1", text:"Du hast den Baustellen-Bereich erreicht. Die Story ist hier momentan noch in Arbeit, du wirst das in ein paar Tagen betreten k√∂nnen, wenn du Vorschl√§ge hast wie die Story weitergehen soll, dann einfach in deine Gedanken schreiben, danke!", choices:[{ text:"Zur√ºck zum letzten Akt", next: () => {const last = getLastActScene(); return last ? last : "0_0";}},{ text:"Spiel beenden", next:null}] }, 
  "0_0": { label:"Akt 0, Szene 0", text:"... Du h√§lst inne. Vielleicht ist es besser so, du l√§sst den Beh√§lter hier stehen. Vielleicht ist heute nicht der Tag f√ºr Geheimnisse. Der Fahrradkeller ist leer, es riecht nach Beton und kalter Luft. Du schlie√üt deine Jacke. Bis auf den Beh√§lter wirkt alles normal. Du schiebst dein Fahrrad hinaus. Die T√ºr f√§llt hinter dir zu. Der Abend empf√§ngt dich als w√§re nichts gewesen. Die Stra√üen sind still. Und du f√§hrst nach Hause...", choices:[{ text:"Zur√ºck zum letzten Akt", next: () => {const last = getLastActScene(); return last ? last : "0_0";}},{ text:"Spiel beenden", next:null}] }, 
  "1_1": { label:"Akt 1, Szene 1", text:"DER KELLER. Der letzte Schultag vor den Ferien h√§tte leicht sein sollen. Aber irgendetwas hat den Tag in die L√§nge gezogen. Stunden, die sich gezogen haben wie Kaugummi. Als du endlich aus dem Klassenzimmer trittst, ist es schon Abend. Du gehst die Treppen hinunter in den Fahrradkeller. Deine Schritte hallen. Du bist allein. Du willst einfach nur nach Hause. Doch dann h√§lst du inne. In deinem Flaschenhalter steckt etwas, das dort nicht hingeh√∂rt. Ein kleiner Beh√§lter aus durchsichtigem Material. Du bist dir sicher: Der war heute Morgen nicht da. Du gehst einen Schritt n√§her. Dann noch einen. Der Beh√§lter leuchtet schwach, ein warmes, pulsierendes Schimmern, das sich gegen die kalte Kellerluft stemmt. F√ºr einen Moment h√∂rst du nur deinen eigenen Atem. Was tust du, Luisa?", choices:[{ text:"Ich lasse ihn in Ruhe.", next:"0_0", save:"Spiel gestartet" },{ text:"Ich schaue ihn mir genauer an.", next:"1_2", save:"Spiel gestartet" }] }, 
  "1_2": { label:"Akt 1, Szene 2", text:"DER BEH√ÑLTER. Du gehst n√§her an dein Fahrrad heran. Der Beh√§lter sitzt fest im Flaschenhalter, als h√§tte ihn jemand mit Absicht dort platziert. Aus der N√§he wirkt er noch ungew√∂hnlicher: glatt, schwerer als Glas, aber ohne Kratzer, ohne Etikett, ohne jede Spur von Herkunft. Das Licht im Inneren pulsiert langsam. Warm. Ruhig. Fast wie ein Herzschlag. Du legst die Fingerspitzen an die Oberfl√§che. Der Beh√§lter reagiert. Ein leiser Schimmer wandert unter deiner Ber√ºhrung entlang, als w√ºrde er dich erkennen. F√ºr einen Moment wird der Keller heller. Dann wird es wieder still. Der Beh√§lter liegt schwer in deiner Hand. Und das Licht darin wartet. Was tust du, Luisa?", choices:[{ text:"Ich lege ihn zur√ºck.", next:"0_0" },{ text:"Ich √∂ffne ihn.", next:"1_3" }] }, 
  "1_3": { label:"Akt 1, Szene 3", text:"DAS LICHT. Du √∂ffnest den Beh√§lter. Ein warmer Hauch entweicht. Du siehst hinein. Im Inneren des Beh√§lters liegt kein Gegenstand im klassischen Sinn. Es ist eher... ein Zustand. Ein Fragment aus Licht, das sich nicht an die Regeln der Welt h√§lt. Es hat keine feste Form. Manchmal wirkt es wie ein kleiner Splitter, manchmal wie ein Tropfen, manchmal wie ein winziger Nebelwirbel aus Helligkeit. Es leuchtet nicht stark. Es glimmt. Warm. Ruhig. In einem Rhythmus. Wenn man genauer hinsieht, erkennt man feine Linien im Licht. Wie winzige Sternbahnen, die sich umeinander drehen. Nicht chaotisch, sondern harmonisch, wie ein kleines Universum im Glas. Das Licht ist nicht hei√ü. Es ist nicht kalt. Und manchmal, wenn man es aus dem Augenwinkel betrachtet, scheint es sich zu bewegen, als w√ºrde es auf etwas reagieren. Oder auf jemanden. Was tust du, Luisa?", choices:[{ text:"Ich schlie√üe den Beh√§lter wieder.", next:"0_0" },{ text:"Ich greife nach dem Licht.", next:"1_4" }] }, 
  "1_4": { label:"Akt 1, Szene 4", text:"DER √úBERGANG. Du h√§lst den Beh√§lter in der Hand. Das Licht darin pulsiert. Du atmest ein. Du greifst nach dem Licht. F√ºr einen Augenblick sp√ºrst du nichts. Nur W√§rme. Nur Stille. Dann passiert alles gleichzeitig. Das Licht schie√üt nach oben, umh√ºllt deine Hand, zieht sich an dir fest wie ein Faden aus Energie - und die Welt unter deinen F√º√üen bricht weg. Der Fahrradkeller l√∂st sich auf. Die K√§lte verschwindet. Die Ger√§usche verschwinden. Du wirst nicht gesto√üen, nicht gezogen - du wirst √ºbergeben. Du schwebst. Um dich herum √∂ffnet sich ein Raum aus Sternen. Langsam, weit, still. Als w√ºrdest du durch ein Universum gleiten, das gerade erst beschlossen hat, zu existieren. Vor dir entsteht ein Lichtpunkt. Er w√§chst. Er wird zu einer Form. Zu einem H√ºgel. Gras, so gr√ºn, dass es fast leuchtet. Ein Wind, den du nicht sp√ºrst, bewegt die Halme. Auf dem H√ºgel steht ein Tisch. Zwei St√ºhle. Auf einem der St√ºhle sitzt jemand. Du kannst die Person sehen. Die Umrisse. Die Haltung. Die Pr√§senz. Aber jedes Mal, wenn du versuchst, das Gesicht zu erkennen, verwischt es. Etwas in dir sagt dir, dass du diese Person kennen solltest. Dass du sie vielleicht sogar kennst. Aber die Welt l√§sst es nicht zu. Noch nicht. Die Figur sitzt ruhig da. Wartend. Nicht bedrohlich. Nicht einladend. Einfach... da. Was tust du, Luisa?", choices:[{ text:"Ich gehe zu der Person.", next:"1_5" },{ text:"Ich laufe von der Person weg.", next:"1_6" }] }, 
  "1_6": { label:"Akt 1, Szene 6", text:"DER RAND. Etwas in dir zieht sich zusammen. Kein klarer Gedanke, eher ein Instinkt. Ein Gef√ºhl. Zu viel. Zu fremd. Dein K√∂rper entscheidet schneller als dein Kopf. Du rennst. Der H√ºgel bleibt hinter dir zur√ºck, der Tisch, die zwei St√ºhle, die verschwommene Gestalt, deren Gesicht du nicht erkennen kannst. Das Gras unter deinen F√º√üen gibt leicht nach, als w√ºrde es dich nicht wirklich ber√ºhren. Die Welt um dich herum bleibt still, zu still, w√§hrend du weiterl√§ufst. Und weiter. Und weiter. Bis die Welt pl√∂tzlich endet. Vor dir f√§llt der Boden einfach ab. Kein Abhang. Kein √úbergang. Nur ein scharfer Schnitt als h√§tte jemand die Welt ausgeschnitten und in den Weltraum gelegt. Unter dir breitet sich ein Meer aus Sternen aus. Lebendig. Bewegend. Unendlich. Hinter dir der H√ºgel. Vor die liegt das Nichts. Was tust du, Luisa?", choices:[{ text:"Ich springe.", next:"0_0" },{ text:"Ich kehre um.", next:"1_5" }] }, 
  "1_5": { label:"Akt 1, Szene 5", text:"DER TISCH. Du gehst den H√ºgel hinauf. Der Tisch steht dort, schlicht, aus hellem Holz. Zwei St√ºhle. Einer davon ist besetzt. Die Gestalt sitzt ruhig da. Du kannst die Umrisse klar erkennen - Schultern, H√§nde, Haltung. Aber jedes Mal, wenn dein Blick das Gesicht erreichen will, verwischt es, als w√ºrde die Welt selbst eine Grenze ziehen. Du setzt dich. Der Stuhl ist warm, obwohl hier keine Sonne scheint. Du beginnst das Gespr√§ch. Es f√ºhlt sich richtig an, als h√§ttest du schon mit dieser Person gesprochen. Die Gestalt neigt leicht den Kopf. Dann antwortet sie. Nicht laut, nicht mit klaren Worten, eher wie ein Gedanke, der sich in dir formt. Du nimmst wahr, dass sie sich Creator nennt. Dass sie dich erwartet hat. W√§hrend sie weiter spricht, sp√ºrst du etwas, das du nicht einordnen kannst. ein Eindruck, dass der Creator dich aufmerksam beobachtet. Nicht wertend. Nicht erwartungsvoll. Eher so, als w√ºrde er etwas verstehen wollen, das ihm selbst noch nicht ganz klar ist. Dann ver√§ndert sich die Stimmung. Nicht bedrohlich, eher wie ein leiser √úbergang. Der Creator spricht von einer Aufgabe. Nicht als Befehl, nicht als Pr√ºfung, sondern als M√∂glichkeit. Etwas, das du tun k√∂nntest, wenn du willst. Du sp√ºrst, dass die Entscheidung bei dir liegt. Der Tisch wirkt pl√∂tzlich wie eine Schwelle. Ein Anfang. Die Frage steht im Raum, klar, ruhig, unausgesprochen: Bist du bereit, diese Mission anzunehmen, Luisa?", choices:[{ text:"Ich lehne ab.", next:"0_0" },{ text:"Ich akzeptiere die Mission.", next:"1_7" }] }, 
  "1_7": { label:"Akt 1, Szene 7", text:"DIE MISSION. Als du deine Entscheidung getroffen hast, ver√§ndert sich die Welt kaum sichtbar. Der H√ºgel bleibt, der Tisch bleibt, aber die Luft wirkt anders. Klarer, dichter, als h√§tte jemand die Sch√§rfe leicht erh√∂ht. Die Gestalt vor dir versucht f√ºr einen Moment, Form zu halten. Du sp√ºrst, wie sie sich sammelt, wie sie sich konzentriert, als wolle sie dir etwas zeigen, das schwer zu zeigen ist. Doch das Gesicht bleibt verschwommen, als w√ºrde die Welt selbst verhindern, dass du es erkennst. Der Creator erkl√§rt dir, dass diese Welt gr√∂√üer ist, als du bisher gesehen hast. Dass sie aus W√§ldern, Lichtungen, D√∂rfern, Ruinen und Fl√ºssen besteht, aus Orten, die ruhig sind, aber nicht vollst√§ndig. Er l√§sst dich sp√ºren, dass die Welt fragmentiert ist. Nicht kaputt - nur unvollst√§ndig. Als h√§tte jemand ein wundersch√∂nes Bild gemalt und dann einige Teile bewusst leer gelassen. Er sagt dir, dass diese Fragmente nicht zuf√§llig fehlen. dass diese Welt unvollst√§ndig ist. Nicht kaputt - nur offen. Als w√§re sie noch dabei, sich zu formen. Er erkl√§rt dir, dass du die Welt nicht retten musst. Dass du nichts beweisen musst. Dass du nur entscheiden musst, wie viel du sehen willst und wie viel zu zeigen willst. Denn jedes Fragment, das du findest, macht die Welt klarer. In der Ferne √∂ffnet sich ein Weg. Ein schmaler Pfad, der in einen Wald f√ºhrt, dessen B√§ume noch keine Schatten werfen, weil sie erst betreten werden m√ºssen. Du willst gerade aufstehen, als sich die Gestalt vor dir noch einmal regt. Eine Frage legt sich in dich. Eine Frage, die die Welt speichern will, weil sie bestimmt, wie sie dir begegnen soll. Luisa, willst du diese Welt erkunden oder sie erst einmal nur beobachten?", choices:[{ text:"Erkunden.", next:"2_1", save:"sie will erkunden" },{ text:"Beobachten.", next:"2_1" , save:"sie will beobachten"}] }, 
  "2_1": { label:"Akt 2, Szene 1", text:"DIE AUSSICHT. Du folgst dem Pfad tiefer in den Wald hinein. Das Licht wird schw√§cher, nicht bedrohlich, sondern wie ein Tag, der sich langsam zur Ruhe legt. Die Ger√§usche des Waldes begleiten dich - leises Rascheln, ein Vogelruf, der Wind, der durch die Bl√§tter streicht. Alles wirkt vertraut, obwohl du es zum ersten Mal h√∂rst. Der Pfad steigt an. Sanft zuerst, dann steiler. Du merkst, dass du h√∂her kommst, dass der Wald sich √∂ffnet. Nach einer Weile lichtet, sich das Dickicht. Ein letzter Schritt, und du trittst hinaus auf eine breite, offene Fl√§che. Eine Lichtung. Und erst jetzt erkennst du, wo du eigentlich bist. Du stehst auf einem Berg. Am Fu√ü des Berges breitet sich eine gro√üe Stadt aus. Mittelalterlich, verwinkelt, von Mauern umgeben, durchzogen, von einem breiten Fluss, der im Abendlicht glitzert. T√ºrme ragen in den Himmel, Br√ºcken spannen sich √ºber das Wasser, und selbst aus dieser Entfernung siehst du die Bewegung der Menschen, die Lichter, die angehen, das Leben, das dort pulsiert. Doch es ist weit weg. Zu weit, um jetzt noch dorthin zu gelangen. Du atmest tief ein, und als du dich nach rechts umschaust. entdeckst du etwas, das dir n√§her ist. Auf einer benachbarten Bergspitze steht eine kleine Befestigung. Ein Ring aus Stein, ein paar T√ºrme, eine Mauer, und dahinter H√§user, eng gebaut, warm beleuchtet. Ihr Licht wirkt einladend, wie ein Ort, der dich erwartet. Du sp√ºrst, dass du dorthin willst. Der Pfad, der zur kleinen Befestigung f√ºhrt teilt sich ein St√ºck weiter oben. Der erste Weg f√ºhrt dich zur√ºck in den Wald. Der zweite Weg f√ºhrt dich √ºber einen schmalen Grat. Welchen Weg nimmst du, Luisa?", choices:[{ text:"Den ersten Weg.", next:"2_2" },{ text:"Den zweiten Weg.", next:"2_3"}] }, 
  "0_1": { label:"Akt 0, Szene 1", text:"Du blinzelst und die Welt ver√§ndert sich. Nicht abrupt - eher wie ein √úbergang, der so weich ist, dass du erst im Nachhinein merkst, dass er passiert ist. Du stehst wieder auf dem H√ºgel. Dem ersten Ort, den du in dieser Welt gesehen hast. Doch diesmal ist er stiller. Der Tisch steht noch da. Der Wind bewegt das Gras. Aber die Gestalt ist verschwunden. Keine Stimme. Keine Pr√§senz. Nur Stille. Auf dem Tisch liegt ein einzelner Zettel. Sauber gefaltet, als h√§tte jemand ihn mit Sorgfalt dort abgelegt. F√ºr dich. Nur f√ºr dich. Als du ihn aufhebst, steht darauf nur eine einzige Frage. Schlicht. Ehrlich. Hat es dir gefallen, Luisa?", choices:[{ text:"Ja, war ok.", next:"0_0", save:"Sie fand das Spiel ok" },{ text:"Nicht wirklich.", next:"0_0" , save:"Sie fand das Spiel nicht so gut"}] }, 
  "2_3": { label:"Akt 2, Szene 3", text:"DER GRAT. Der Pfad √ºber den Grat ist schmaler, als er aussah. Links f√§llt der Berg steil ab, so tief, dass der Abendnebel den Boden verschluckt. Rechts ragen Felsen auf, kantig, kalt, wie Rippen aus Stein. Der Wind ist st√§rker hier oben. Er zerrt an deiner Kleidung, schiebt dich leicht aus dem Gleichgewicht, und du musst dich manchmal gegen ihn lehnen, um weiterzukommen. Der Weg ist nicht gef√§hrlich genug, um dich aufzuhalten - aber gef√§hrlich genug, um dich wachsam zu machen. Du gehst weiter. Nach ein paar Minuten verengt sich der Grat noch mehr. Ein Felsvorsprung ist abgebrochen und du musst dich seitlich an der Wand entlangschieben, die Finger in kleine Ritzen gekrallt. Ein Schritt. Noch einer. Dann rutscht ein Stein unter deinem Fu√ü weg. Du f√§llst noch nicht - aber du verlierst den Halt. Dein K√∂rper kippt nach au√üen, und du klammerst dich an die Felswand, die H√§nde verkrampft, die F√º√üe suchend, der Abgrund unter dir still und endlos. F√ºr einen Augenblick f√ºhlt sich alles zu gro√ü an. Zu hoch. Zu weit. Zu sp√§t. Doch dann sp√ºrst du etwas. Keine Hand. Keine Stimme. Nur W√§rme. Eine W√§rme, die sich langsam in dir ausbreitet, als w√ºrde die Welt selbst einen Schritt auf dich zu machen. Nicht dr√§ngend. Nicht fordernd. Ein Angebot. Du sp√ºrst, dass etwas - oder jemand - dir helfen will. Du m√ºsstest es nur zulassen. Was wirst du tun, Luisa?", choices:[{ text:"Ich lasse es zu.", next:"2_5" },{ text:"Ich gebe auf.", next:"0_1"}] }, 
  "2_2": { label:"Akt 2, Szene 2", text:"DIE FEE. Deine Wahl f√ºhrt dich wieder in den Wald, zur√ºck unter das Bl√§tterdach, wo das Abendlicht nur noch in d√ºnnen, goldenen Streifen den Boden erreicht. Die Luft ist k√ºhl, und der Geruch von Moos und feuchter Erde begleitet dich. Du gehst weiter, bis ein leises, helles Summen die Stille durchbricht. Zuerst denkst du an ein Insekt, doch der Klang ist zu klar, zu melodisch. Zwischen zwei Farnen schwebt pl√∂tzlich ein kleines Licht auf. Es flackert, zittert, und nimmt dann Form an. Eine Fee. Sie ist kaum gr√∂√üer als deine Hand, mit Fl√ºgeln, die im Abendlicht schimmern, als w√§ren sie aus d√ºnnem Glas. Sie fliegt ein St√ºck n√§her, neugierig, aber nicht misstrauisch. Sie mustert dein Gesicht, schwebt einmal um dich herum, und bleibt dann direkt vor deinen Augen stehen. >Sieh einer an...< Ihre Stimme klingt wie ein Gl√∂ckchen >Sie hat die blauen Augen wie eine Fee.< Die Fee l√§chelt. Dann dreht sie sich einmal im Kreis, l√§sst ein paar glitzernde Funken fallen und verschwindet zwischen den B√§umen, als w√§re sie nie da gewesen. Du denkst dir selbst...", choices:[{ text:"Die sind doch gar nicht blau.", next:"2_4", save: "Hat keine blauen Augen" },{ text:"Oh... wenn das so ist.", next:"2_4" , save:"Hat blaue Augen."}] }, 
  "2_5": { label:"Akt 2, Szene 5", text:"DER SCHRITT. Du l√§sst es zu. In dem Moment, in dem du die Entscheidung triffst, ver√§ndert sich etwas - nicht in dir, sondern um dich herum. Die Luft wird w√§rmer. Der Fels unter deinen Fingern wirkt weniger scharf, als h√§tte jemand die Kanten gegl√§ttet. Der Grat verformt sich leicht, kaum sichtbar. Ein kleiner Vorsprung w√§chst aus dem Fels, genau dort, wo du ihn brauchst. Du setzt den Fu√ü darauf. Er h√§lt. Du atmest aus, langsam. Der Wind ist noch da, aber er wirkt weniger feindlich. Die K√§lte des Steins ist noch da, aber sie schneidet nicht mehr. Du gehst weiter. Diesmal konzentrierter. Ruhiger. Du erinnerst dich zur√ºck an die Alpen√ºberquerung. Wie du die Berge Schritt f√ºr Schritt bezwungen hast. Der Grat wird breiter. Der Wind l√§sst nach. Und irgendwann, nach einer Weile, erkennst du vor dir die ersten Mauern. Was tust du, Luisa?", choices:[{ text:"Endspurt.", next:"2_4" },{ text:"Kurze Pause.", next:"2_4"}]}, 
  "2_4": { label:"Akt 2, Szene 4", text:"DAS TOR. Die letzten Meter f√ºhren √ºber festeren Boden. Du stehst jetzt vor den Mauern. Nicht hoch, aber solide. Fackeln brennen an den Torpfosten, und ihr Licht wirft warme Streifen √ºber den Boden. Du gehst n√§her. Das Tor ist geschlossen. Eine einzelne Wache steht davor. Ein Mann in Kettenhemd, mit einem dunklen Umhang, der im Wind leicht flattert. Er hat dich schon bemerkt. Sein Blick wandert √ºber dein Gesicht, dann √ºber deine Kleidung. Die graue Winterjacke, die hellblaue Hose, die wei√üen Schuhe, alles wirkt hier fehl am Platz, wie aus einer anderen Zeit gefallen. Die Wache blinzelt irritiert. Die Farben, die Stoffe, die Schnitte - nichts davon passt zu dem, was er kennt. >Das...< Er tippt mit dem Finger in die Luft, als w√ºrde er das richtige Wort suchen. >...ist ungew√∂hnliche Kleidung f√ºr Reisende.< Der Mann richtet sich etwas auf, legt die Hand an den Griff seines Speers, nicht drohend, sondern pflichtbewusst. >Nun gut,< sagt er. >Wer auch immer du bist - niemand kommt einfach so hinein.< Er macht einen Schritt n√§her, sein Gesicht halb im Fackelschein, halb im Schatten. >Also sag mir...< Seine Stimme wird ruhiger, aber nicht weicher. >Warum willst du in unsere Festung?<", choices:[{ text:"Ich brauche einen Platz f√ºr die Nacht.", next:"2_6" },{ text:"Ich wei√ü nicht genau.", next:"2_7" , save:"Sie wei√ü nicht xD"}] }, 
  "2_6": { label:"Akt 2, Szene 6", text:"DER EINTRITT. Der W√§chter blinzelt, als h√§tte er deine Worte erst pr√ºfen m√ºssen. Sein Blick wird weicher, aber er bleibt wachsam. >Ein Platz in der Nacht also...< Er √ºberlegt kurz. >Viele sagen das. Aber nicht jeder meint es so.< Er tritt einen Schritt n√§her, nicht bedrohlich, eher neugierig. >Bist du allein unterwegs?< Du antwortest. >Wonach sieht es aus.< Der W√§chter nickt langsam, als w√ºrde er etwas in dir erkennen. >Und hast du jemanden, der auf dich wartet?< Du z√∂gerst kurz. >Wei√ü nicht.< Der W√§chter atmet leise aus, fast wie jemand, der eine Entscheidung trifft. >Dann verstehe ich, warum du hier bist.< Er legt die Hand auf das Tor, aber es √∂ffnet sich noch nicht. Er schaut dich noch einmal an. >Bevor ich dich hineinlasse... sag mir eines.< Seine Stimme wird ruhiger, pers√∂nlicher. >Bist du dir sicher?<", choices:[{ text:"Ja.", next:"2_8", save:"yay C:" },{ text:"Nein.", next:"2_8" , save:"ok unsichere luisa hase"}] }, 
  "2_7": { label:"Akt 2, Szene 7", text:"DAS LICHT. Der W√§chter sagt nichts mehr. Er sieht dich an, als h√§tte er eine Entscheidung getroffen, die ihm selbst nicht ganz gef√§llt. >Wenn du es selbst nicht wei√üt... dann kann ich dich nicht hineinlassen.< Du drehst dich um. Der Weg zur√ºck ist dunkel. Du gehst ein paar Schritte, ohne zu wissen wohin. Dann findest du einen flachen Stein am Rand des Pfades. Er ist kalt, aber stabil. Du setzt dich. Die Beine ziehst du an den K√∂rper, so wie du es manchmal im Unterricht machst. Die Arme liegen locker darum. Der Kopf sinkt leicht nach vorne. Die Welt ist still. Nur der Wind bewegt sich. Und du atmest. F√ºr einen Moment bist du einfach nur da. Kein Ziel. Keine Richtung. Nur du. Dann passiert es. Ein Schimmer. So leise, dass du ihn fast √ºberh√∂rst. Ein blauer Lichtpunkt erscheint ein paar Meter vor dir, knapp √ºber dem Boden. Er ist klein. Zitternd. Er flackert einmal. Dann wird er klarer. Ruhiger. Das Licht bewegt sich langsam auf dich zu, bleibt aber auf Abstand - als wolle es dich nicht erschrecken. Es schwebt dort, wo du es gut sehen kannst. Das Licht dreht eine kleine, vorsichtige Bahn in der Luft. Dann fliegt es auf einen schmalen Pfad zu, der vorher nicht da war. Oder den du vorher nicht gesehen hast. Was tust du, Luisa?", choices:[{ text:"Ich folge dem Licht.", next:"2_9" },{ text:"Ich bleibe sitzen.", next:"2_10" , save:""}] }, 
  "2_8": { label:"Akt 2, Szene 8", text:"DIE GASSEN. Die Luft ist w√§rmer hier drinnen, voller Ger√ºche: Holz, Rauch, Brot, Metall. Die Gassen sind schmal verwinkelt, wie Adern, die sich durch den Berg ziehen. Es wird Nacht. Laternen h√§ngen an Seilen zwischen den H√§usern, ihr Licht schwankt im Wind. Menschen gehen an dir vorbei - manche in Eile, manche langsam, manche mit K√∂rben, manche mit Werkzeugen. Niemand schenkt dir besondere Aufmerksamkeit, aber alle scheinen dich zu registrieren. Ein kurzer Blick, ein Nicken, ein neugieriges Stirnrunzeln. Du gehst weiter. Die H√§user sind aus hellem Stein gebaut, mit dunklen Holzbalken, die Schatten werfen. Fenster stehen offen, Stimmen dringen heraus, Lachen, das Klirren von Geschirr. Ein Hund l√§uft an dir vorbei, bleibt kurz stehen, schnuppert, entscheidet sich dann, dass du uninteressant bist, und trottet weiter. Die Gasse √∂ffnet sich. Vor dir liegt ein Platz. Breit, hell, lebendig. Fackeln stehen in hohen Haltern, ihr Licht tanzt √ºber das Kopfsteinpflaster. Menschen stehen in Gruppen zusammen, reden, lachen, tauschen Dinge aus. Ein Musiker spielt eine leise Melodie auf einem Saiteninstrument, das du nicht kennst. Kinder rennen zwischen den Beinen der Erwachsenen hindurch, eines tr√§gt eine Kreide in der Hand. Du bleibst stehen. Nicht aus Unsicherheit - eher, weil du den Moment aufsaugen willst. Die W√§rme. Die Stimmen. Das Gef√ºhl, dass dieser Ort lebt, ohne dich zu brauchen, aber dich trotzdem willkommen hei√üt. Am Rand des Platzes steht ein Gasthaus. Ein Holzschild h√§ngt √ºber der T√ºr, darauf ein einfaches Symbol: Ein Kreis mit einem kleinen Stern darin. Das Licht aus dem Inneren ist warm, golden, einladend. Du sp√ºrst M√ºdigkeit. Aber auch Neugier. Was tust du, Luisa?", choices:[{ text:"Ich spreche mit den Leuten.", next:"2_11" },{ text:"Ich gehe ins Gasthaus.", next:"2_12" , save:""}] }, 
  "2_9": { label:"Akt 2, Szene 9", text:"DER PFAD. Das Licht wartet nicht. Es dr√§ngt nicht. Es schwebt einfach da. Ein kleiner, blauer Punkt, der im Wind flackert. Du stehst auf, klopfst den Staub vom Stein, auf dem du gesessen hast, und atmest einmal tief durch. Dann setzt du einen Schritt. Nur einen. Das Licht bewegt sich. Langsam. Behutsam. Als w√ºrde es sicherstellen wollen, dass du wirklich mitkommst. Der Pfad f√ºhrt dich seitlich am Berg entlang. Die Mauern der Festung bleiben √ºber dir, hoch und dunkel, aber nicht feindlich. Eher wie ein Tier, das schl√§ft und dich nicht bemerkt. Unter dir f√§llt der Hang ab. Der Abend hat sich in ein tiefes Blau verwandelt, und die Lichter der Stadt im Tal glitzern wie verstreute M√ºnzen. Du bleibst kurz stehen. Der Ausblick ist zu gro√ü, um ihn einfach zu √ºbergehen. Der Fluss unten zieht sich wie ein silberner Faden durch die Stadt. Du siehst winzige Bewegungen. Ein Leben, das weitergeht, egal, wo du gerade bist. Das Licht wartet. Geduldig. Du gehst weiter. Der Pfad wird enger, dann wieder breiter. Die Mauern der Festung ziehen sich wie ein grauer R√ºcken an dir vorbei. Du h√∂rst Schritte hinter dem Stein, Stimmen, vielleicht Wachen - aber niemand bemerkt dich. Das Licht f√ºhrt dich dorthin, wo die Mauer einen kleinen Spalt hat. Er ist kaum sichtbar. Ein Riss zwischen zwei Felsbl√∂cken, gerade breit genug f√ºr eine Person. Du musst dich seitlich drehen, um hindurchzukommen. Und dann siehst du etwas. Auf dem Stein, direkt neben dem Spalt, steht etwas geschrieben. Mit Kreide. Unordentlich. Verschmiert. Kinderhandschrift. Nur ein Satz: >Was macht einen Menschen mutig?< Darunter zwei Pfeile, grob gezeichnet: ", choices:[{ text:"Wenn er keine Angst hat.", next:"2_8", save:"Mutig, wenn man ohne Angst ist" },{ text:"Wenn er trotzdem weitergeht.", next:"2_8" , save:"Mutig, wenn man trotzdem weitergeht"}] },
  "2_10": { label:"Akt 2, Szene 10", text:"DIE NACHT. Du entscheidest dich gegen das Licht. Das Licht bleibt hinter dir stehen, als w√ºrde es dich nicht aufhalten wollen. Du gehst ein St√ºck weiter, weg vom Pfad, weg von der Richtung, die dir gezeigt wurde. Das Gras unter deinen Schuhen ist weich, und die Luft wird k√ºhler, je weiter du dich entfernst. Du findest einen kleinen Platz zwischen einem Felsen und einem niedrigen Baum, der seine √Ñste wie eine sch√ºtzende Hand √ºber dich legt. Du setzt dich. Ziehst die Jacke enger um dich. Die Nacht beginnt ganz normal. Ein paar Grillen. Ein Wind, der durch die Zweige streicht. Ein Himmel, der langsam dunkler wird. Die ersten Sterne, die aufblinken wie kleine Erinnerungen. Du lehnst dich zur√ºck. Die Welt ist still. Eine Weile passiert nichts. Nur die Nacht, die Nacht ist. Doch dann √§ndert sich etwas. Nicht abrupt. Nicht unheimlich. Sondern so sanft, dass du es erst gar nicht bemerkst. Die Sterne bewegen sich ein wenig schneller. Nur ein Hauch. Als h√§tte jemand die Welt ein kleines St√ºck weitergedreht. Die Schatten am Boden wandern zu fl√ºssig. Der Mond steigt ein bisschen zu gleichm√§√üig. Die Wolken ziehen wie in einem Zeitraffer. Du blinzelst. Nicht aus Angst. Aus Staunen. Und dann merkst du es. Es passiert nicht einfach. Es passiert wegen dir. Nicht, weil du es kontrollierst. Sondern weil die Welt auf dich reagiert. Du hebst die Hand ein kleines St√ºck. Nur ein Reflex. Und die Sterne ziehen ein bisschen schneller. Du senkst sie wieder. Und die Bewegung verlangsamt sich. Du atmest ein. Die Wolken beschleunigen. Du atmest aus. Sie werden langsamer. Die Zeit ist nicht dein Werkzeug. Aber f√ºr den Moment ist sie auf dich abgestimmt. Die Sterne ziehen Linien. Der Himmel dreht sich wie ein langsamer Wirbel. Die Nacht flie√üt an dir vorbei wie Wasser. Die Schatten tanzen. Die Dunkelheit wird heller. Der Morgen kommt wie ein einziger Atemzug. Du wei√üt nicht, wie lange du geschlafen hast. Oder ob du geschlafen hast. Aber als du die Augen √∂ffnest, liegt Morgengrauen √ºber der Welt. Willst du noch etwas sitzen bleiben... oder jetzt zur Festung gehen, Luisa?", choices:[{ text:"Noch kurz sitzen bleiben.", next:"2_15" },{ text:"Zur Festung gehen.", next:"2_15" , save:""}] },
  "2_11": { label:"Akt 2, Szene 11", text:"DER PLATZ. Der Platz ist ruhig, aber lebendig. Ein paar Stimmen, ein paar Schritte, ein paar Blicke, die kurz an dir h√§ngen bleiben. Du gehst weiter. Du siehst eine √§ltere Frau mit einem Korb voller Kr√§uter. Sie bleibt stehen, als du n√§herkommst, und ihr Blick ist warm, fast so, als w√ºrde sie dich schon lange kennen. Ihre Stimme ist weich, aber sicher. >Manchmal erkennt man Menschen daran, wie sie stehen. Du stehst... klar.< Sie l√§chelt dich an, ein stilles, wissendes L√§cheln, das l√§nger bleibt als der Moment selbst. Du gehst weiter. Am Rand des Platzes sitzt ein kleines M√§dchen auf einer Stufe, ein Notizbuch auf den Knien. Sie hebt den Kopf, als du vorbeikommst, und ihre Augen sind gro√ü, klar, neugierig. >Warte.< sagt sie, bevor du an ihr vorbeigehen kannst. Sie klappt ihr Notizbuch zu und rutscht ein St√ºck zur Seite, als w√ºrde sie dir Platz machen, obwohl du gar nicht sitzen willst. >Ich schreibe Geschichten.< sagt sie. >Aber nicht die, die man sich ausdenkt. Die, die man sieht.< Sie zeigt auf dich. Du blinzelst, √ºberrascht, aber sie redet einfach weiter, als w√§re das alles selbstverst√§ndlich. >Ich habe mal eine Geschichte √ºber ein M√§dchen geschrieben, das immer weitergegangen ist, aus wenn es nicht wusste wohin.< Sie schaut dich lange an. >Wei√üt du, was das M√§dchen am Ende gelernt hat?<. Du sagst nichts. >Dass man manchmal erst sp√§ter versteht, warum man losgegangen ist.< Sie steht auf, das Notizbuch fest an die Brust gedr√ºckt. >Darf ich dich etwas fragen?< Du wolltest gerade zum Gasthaus gehen, aber h√§lst nochmal an. >Wie hei√üt du?<", choices:[{ text:"Luisa.", next:"2_12", save: "Es ist Luisa?" },{ text:"Du verwechselst mich.", next:"2_12" , save:"Es ist nicht Luisa?"}] },
  "2_12": { label:"Akt 2, Szene 12", text:"DAS HAMAL. Du √∂ffnest die T√ºr des Gasthauses >Zum Hamal<. Ein warmer Duft schl√§gt dir entgegen - etwas zwischen gebratenen Kr√§utern, frischem Brot und einer Suppe, die schon den ganzen Tag vor sich hinzieht. Das Gasthaus ist nicht gro√ü, aber es f√ºhlt sich an wie ein Ort, an dem man ankommen darf. √úber der Theke h√§ngt ein kleines Holzschild >Zum Hamal< Benannt nach dem hellsten Stern im Widder. Du trittst ein. Ein paar Leute sitzen an Tischen, reden leise, lachen, essen. Niemand starrt dich an. Aber ein paar Blicke streifen dich. Der Wirt hebt den Kopf, als er dich sieht. Ein Mann mit ruhigen Augen, die mehr beobachten als bewerten. >Setz dich, wenn du willst.< sagt er. >Du siehst aus, als k√∂nntest du etwas Warmes gebrauchen.< Du setzt dich an einen kleinen Tisch am Fenster. Der Wirt kommt zu dir, wischt sich die H√§nde an der Sch√ºrze ab und stellt sich neben dich. >Wir haben heute zwei Gerichte.< sagt er. Er zeigt auf eine kleine Tafel, die er wohl extra f√ºr den Tag beschrieben hat. Oben steht >Kr√§utersuppe mit frischem Brot< und darunter >Geschmorte Wurzelgem√ºse mit Honigglasur<. Der Wirt schaut dich an. Was m√∂chtest du essen, Luisa?", choices:[{ text:"Kr√§utersuppe.", next:"2_13", save:"Sie isst Kr√§utersuppe" },{ text:"Wurzelgem√ºse.", next:"2_14" , save:"Sie isst Wurzelgem√ºse"}] },
  "2_13": { label:"Akt 2, Szene 13", text:"DIE KR√ÑUTERSUPPE. Du bleibst noch einen Moment sitzen, nachdem der Wirt, dir die Schale hingestellt hat. Die Kr√§utersuppe dampft leise vor sich hin, und der Duft ist warm. Du nimmst den ersten L√∂ffel, und er schmeckt nach etwas, das du nicht benennen kannst. Du isst langsam. Nicht, weil du m√ºde bist, sondern weil der Moment es verdient. Jeder L√∂ffel w√§rmt dich ein St√ºck weiter von innen, und du merkst, wie die Anspannung des Tages sich l√∂st, ohne dass du es bewusst zul√§sst. Der Raum um dich herum ist ruhig geworden. Das Knacken von Holz im Kamin. Alles zusammen ergibt eine Art Hintergrundmusik, die dich nicht ablenkt, sondern tr√§gt. Als du fertig bist, kommt der Wirt zu dir. Er nimmt die Schale. >Wenn du ein Zimmer brauchst, oben ist noch eines frei.< Du nickst. Er f√ºhrt dich die Treppe hinauf. Die Stufen knarren. Oben √∂ffnet er eine T√ºr. Das Zimmer ist klein, aber warm. Ein Bett, ein Fenster, ein Tisch. Du ziehst nur deine Winterjacke aus. Sie ist schwer vom Tag, und als du sie √ºber den Stuhl legst, wirkt der Raum sofort ein bisschen leichter. Du atmest einmal tief durch. Du setzt dich aufs Bett. Der Stoff gibt nach, als h√§tte er auf dich gewartet. Dann legst du dich hin. Die Stille ist weich. Nicht leer. Nur ruhig. Und dann kommt ein Gedanke. Leise. Fast wie ein Fl√ºstern. Erinnerst du dich an deine Tr√§ume, Luisa?", choices:[{ text:"Ja, manchmal.", next:"2_15", save:"Sie erinnert sich an Tr√§ume" },{ text:"Nein, eher nicht.", next:"2_15" , save:"Sie erinnert sich nicht an Tr√§ume"}] },
  "2_14": { label:"Akt 2, Szene 14", text:"DAS GEM√úSE. Du sitzt noch einen Moment da, nachdem du den letzten bissen des geschmorten Gem√ºses gegessen hast. Es war warm, s√º√ü, kr√§ftig - ein Essen, das nicht nur satt macht, sondern etwas in dir l√∂st. Etwas, das du vielleicht den ganzen Tag mit dir herumgetragen hast, ohne es zu merken. Du lehnst dich zur√ºck. Der Teller ist leer, aber der Geschmack bleibt noch einen Moment auf deiner Zunge, wie ein Echo. Der Raum wirkt jetzt anders - nicht lauter, nicht voller, aber n√§her. Der Wirt kommt zu dir, nimmt den Teller. >Wenn du ein Zimmer brauchst, oben ist noch eines frei.< Du nickst. Er f√ºhrt dich die Treppe hinauf. Die Stufen knarren. Oben √∂ffnet er eine T√ºr. Das Zimmer ist klein, aber warm. Ein Bett, ein Fenster, ein Tisch. Du ziehst nur deine Winterjacke aus. Sie ist schwer vom Tag, und als du sie √ºber den Stuhl legst, wirkt der Raum sofort ein bisschen leichter. Du atmest einmal tief durch. Du setzt dich aufs Bett. Der Stoff gibt nach, als h√§tte er auf dich gewartet. Dann legst du dich hin. Die Stille ist weich. Nicht leer. Nur ruhig. Und dann kommt ein Gedanke. Leise. Fast wie ein Fl√ºstern. Erinnerst du dich an deine Tr√§ume, Luisa?", choices:[{ text:"Ja, manchmal.", next:"2_15", save:"Sie erinnert sich an Tr√§ume" },{ text:"Nein, eher nicht.", next:"2_15" , save:"Sie erinnert sich nicht an Tr√§ume"}] },
  "2_15": { label:"Akt 2, Szene 15", text:"DER MORGEN. Der Morgen in der Festungsstadt ist k√ºhl und klar. Die Sonne steht noch tief, und ihr Licht f√§llt in langen, schmalen Streifen duch die Gassen, als w√ºrde es sich erst an die Mauern gew√∂hnen m√ºssen. Die Luft riecht nach einem Tag, der gerade erst beginnt. Du gehst langsam. Nicht zielgerichtet. Einfach so, wie man geht, wenn man noch nicht wei√ü wohin. Die Stadt ist leise, aber nicht leer. Hier und da h√∂rst du Schritte, Stimmen, das Klirren von Metall, das Scharren eines Besens √ºber Kopfsteinpflaster. Ein Vogel landet auf einer Mauer, sch√ºttelt die Federn, sieht dich an, als w√ºrdest du ihm etwas schulden. Dann fliegt er weiter. Du gehst um eine Ecke - und pl√∂tzlich prallt jemand gegen dich. Ein junger Bote. D√ºnn, au√üer Atem, mit Haaren, die aussehen, als h√§tte er sie im Laufen verloren. Er stolpert einen Schritt zur√ºck, hebt die H√§nde, als wollte er sich entschuldigen, bevor er √ºberhaupt wei√ü, was passiert ist. >Oh! Entschuldigung! Ich-< Er h√§lt inne. Seine Augen wandern √ºber dein Gesicht, als w√ºrde er versuchen, sich an etwas zu erinnern. Oder an jemanden. Dann dr√ºckt er dir einen Brief in die Hand. Einfach so. >Hier. F√ºr dich. Also... glaube ich.< Er runzelt dich Stirn. Du √∂ffnest den Mund, um etwas zu sagen, aber er ist schon wieder weg. Er verschwindet zwischen zwei St√§nden die gerade noch aufgebaut werden, und h√∂rst nur noch das Klappern seiner Stiefel auf dem Pflaster. Du bleibst stehen. Der Brief liegt schwer in deiner Hand. Das Siegel ist schlicht. Kein Wappen. Kein Name. Keine Adresse. Nur ein d√ºnner Faden aus Wachs. Du drehst den Brief um. Nichts. Was ist deine Entscheidung, Luisa?", choices:[{ text:"√ñffnen.", next:"2_16", save:"Sie √∂ffnet den Brief C:" },{ text:"Zur√ºckgeben.", next:"2_17" , save:"Sie l√§sst den Brief"}] },
  "2_16": { label:"Akt 2, Szene 16", text:"DER BRIEF. Du h√§lst den Brief einen Moment lang in der Hand, als w√ºrdest du sp√ºren wollen, ob er wirklich f√ºr dich ist. Das Siegel ist schlicht, das Papier leicht rau, und irgendetwas daran f√ºhlt sich wach an. Nicht alt. Nicht vergessen. Eher wie etwas, das gerade erst geschrieben wurde. Du brichst das Siegel. Es knackt leise, fast sch√ºchtern. Im Inneren liegt ein einzelnes Blatt. Die Schrift ist sauber, aber nicht elegant. Du liest: >Sch√∂n, dass du hier bist Luisa. Genie√üe deinen ersten Tag.< Das war's. Keine Unterschrift. Keine Erkl√§rung. Kein Hinweis darauf, wer das geschrieben hat oder warum. Nur diese zwei Zeilen, die sich anf√ºhlen wie ein warmer Atemzug. Wie ein Gru√ü. Wie ein Willkommen. Du faltest das Papier wieder zusammen. Du hebst den Blick - und erst jetzt nimmst du die Stadt wirklich wahr. Die Festungsstadt erwacht. Fensterl√§den √∂ffnen sich. Ein H√§ndler schiebt einen Wagen √ºber das Pflaster. Eine Katze springt von einer Mauer und verschwindet in einer Seitengasse. Weit hinten, √ºber den D√§chern, ragt ein Turm in den Himmel. Rund. Hoch. Still. Ein Observatorium. Was m√∂chtest du tun, Luisa?", choices:[{ text:"Zum Observatorium gehen.", next:"2_18" },{ text:"Einfach so rumlaufen.", next:"2_19" , save:""}] },
  "2_17": { label:"Akt 2, Szene 17", text:"DER BOTE. Du drehst dich um und gehst dem Boten nach. Es dauert ein wenig, bis du ihn findest - er steht an einer Ecke, sortiert weitere Briefe, nerv√∂s, als h√§tte er Angst, wieder etwas zu verwechseln. >Der Brief... ich glaube, der ist nicht f√ºr mich.< sagst du. Er sieht auf, blinzelt, wird rot. >Oh! Oh nein... ich... √§h... danke!< Er nimmt den Brief zur√ºck, schaut auf das Siegel, runzelt die Stirn. Dann √∂ffnet er ihn. Nur ein kurzer Blick. Er l√§chelt schief. Dann steckt er den Brief weg. Du gehst weiter. Du hebst den Blick - und erst jetzt nimmst du die Stadt wirklich wahr. Die Festungsstadt erwacht. Fensterl√§den √∂ffnen sich. Ein H√§ndler schiebt einen Wagen √ºber das Pflaster. Eine Katze springt von einer Mauer und verschwindet in einer Seitengasse. Weit hinten, √ºber den D√§chern, ragt ein Turm in den Himmel. Rund. Hoch. Still. Ein Observatorium. Was m√∂chtest du tun, Luisa?", choices:[{ text:"Zum Observatorium gehen.", next:"2_18" },{ text:"Einfach so rumlaufen.", next:"2_19" , save:""}] },
  "2_18": { label:"Akt 2, Szene 18", text:"DAS OBSERVATORIUM. Der Weg zum Observatorium f√ºhrt dich durch die oberen Gassen der Festungsstadt. Je h√∂her du kommst, desto stiller wird es. Die Ger√§usche der Stadt bleiben hinter dir zur√ºck, werden weich, ged√§mpft. Der Turm selbst wirkt, als w√ºrde er √ºber allem schweben. Rund. Hoch. Mit einer Kuppel, die im Morgenlicht schimmert, als h√§tte sie die Nacht noch nicht ganz losgelassen. Vor der T√ºr steht niemand. Keine Wache. Kein Schild. Nur eine schwere Holzt√ºr, in die ein Muster eingeritzt ist - Kreise, Linien, Punkte. Du legst die Hand darauf. Das Holz ist k√ºhl. Still. Unnachgiebig. Du dr√ºckst. Nichts. Du klopfst. Ein dumpfer Ton, der im Inneren verschluckt wird. Du wartest. Nichts. Gerade als du dich abwenden willst, h√∂rst du Schritte hinter der T√ºr. Dann √∂ffnet sich ein schmaler Spalt, und ein Mann steckt den Kopf heraus. Er ist √§lter, aber nicht alt. Sein Haar ist grau, aber seine Augen sind hell, wach, freundlich. Er ist √ºberrascht, dich hier so fr√ºh zu sehen. Er √∂ffnet die T√ºr ein St√ºck weiter, aber nicht genug, um dich hineinzulassen. >Tut mir Leid. Wir sind tags√ºber geschlossen. Die Sterne zeigen sich nur nachts... und wir mit ihnen.< Er mustert dich kurz. >Wenn du etwas √ºber Sterne lernen willst...< Er deutet mit dem Kopf nach unten. >Geh in die Bibliothek. Die gro√üe, unter der Stadt. Sie ist offen. Immer. Die B√ºcher dort schlafen nie.< Er lehnt sich ein wenig aus der T√ºr. >Heute Nacht, wird Orion am klarsten zu sehen sein. Drei Sterne in einer Linie, zwei dar√ºber, zwei darunter. Ein altes Muster. Viele Geschichten. Er sieht dich an. Nicht pr√ºfend. Eher... interessiert. >Sag mal.. welches Sternbild ist deines?<", choices:[{ text:"Widder.", next:"2_20" },{ text:"Wei√ü nicht.", next:"2_20" , save:""}] },
  "2_19": { label:"Akt 2, Szene 19", text:"Sie l√§uft rum, trifft auf Schmiede", choices:[{ text:"Baustelle.", next:"-1_-1" },{ text:"Baustelle.", next:"-1_-1" , save:""}] },
  "2_20": { label:"Akt 2, Szene 20", text:"Sie ist jetzt auf dem Weg zur Bibliothek", choices:[{ text:"Baustelle.", next:"-1_-1" },{ text:"Baustelle.", next:"-1_-1" , save:""}] },
  "1_9": { label:"Akt 1, Szene 1", text:"", choices:[{ text:"Baustelle.", next:"-1_-1" },{ text:"Baustelle.", next:"-1_-1" , save:""}] },
}

/********* LOCAL STORAGE *********/
const saveKey = 'luisaStorySave';
let currentScene = null;
let sceneHistory = [];

/********* HINTERGRUNDMUSIK UND TIPPSOUND *********/
const music = document.getElementById('bgMusic');
music.volume = 0.6;
const typeSound = document.getElementById('typeSound');
typeSound.volume = 0.15;
const clickSound = document.getElementById('clickSound');
clickSound.volume = 0.24;

function stopTypeSound() {
  const fade = setInterval(() => {
    if (typeSound.volume > 0.02) {
      typeSound.volume -= 0.02;
    } else {
      clearInterval(fade);
      typeSound.pause();
      typeSound.currentTime = 0;
      typeSound.volume = 0.15;
    }
  }, 20);
}

function typeText(element, text, speed = 40, callback = null) {
  element.innerText = '';
  let i = 0;
  let typingActive = true;

  function typing() {
    if (!typingActive) { stopTypeSound(); return; }

    if (i < text.length) {
      element.innerText += text[i];

      if (text[i] !== ' ' && Math.random() < 0.35) {
        typeSound.currentTime = 0;
        typeSound.play().catch(() => {});
      }

      i++;
      setTimeout(typing, speed);
    } else {
      stopTypeSound();
      typingActive = false;
      if (callback) callback();
    }
  }
  typing();

  return () => { typingActive = false; stopTypeSound(); };
}

/********* HAUPTMEN√ú BUTTONS *********/
document.getElementById('newGameBtn').onclick = function() {
  logActivity('newGame');

  currentScene = "1_1";
  sceneHistory = [];

  inventoryDoc.delete().catch(() => {});
  localStorage.setItem(saveKey, currentScene);

  showGame();
  music.play().catch(e => console.log(e));
}

document.getElementById('loadGameBtn').onclick = function() {
  logActivity('loadGame');

  const saved = localStorage.getItem(saveKey);
  if(saved && story[saved]){
    currentScene = saved;
    showGame();
    music.play().catch(e => console.log(e));
  } else {
    alert("Kein gespeicherter Spielstand gefunden.");
  }
}

/********* SPIEL ANZEIGEN *********/
function showGame(){
  document.getElementById('mainMenu').style.display = 'none';
  document.getElementById('chatContainer').style.display = 'none';
  document.getElementById('gameContainer').style.display = 'flex';
  showScene();
}

/********* SZENE ANZEIGEN *********/
function showScene(){
  const scene = story[currentScene];
  if(!scene) return;

  // ---- AUTOMATISCHER LOCAL SAVE ----
  localStorage.setItem(saveKey, currentScene);

  const [actNum, sceneNum] = currentScene.split('_').map(Number);

  if (
    actNum > 0 &&
    sceneNum === 1 && // ‚≠ê nur Einstiegsszene eines Akts
    !sceneHistory.includes(currentScene)
  ) {
    sceneHistory.push(currentScene);
  }

  const sceneText = document.getElementById('sceneText');
  const choicesDiv = document.getElementById('choices');
  document.getElementById('sceneLabel').innerText = scene.label;

  sceneText.style.display = 'block';
  choicesDiv.style.visibility = 'hidden';

  typeText(sceneText, scene.text, 40, () => {
    choicesDiv.innerHTML = '';
    scene.choices.forEach(choice => {
      const btn = document.createElement('button');
      btn.innerText = choice.text;
      btn.onclick = function(){
        // 1. Entscheidung speichern, falls gesetzt
        if(choice.save) {
            saveDecision(choice.save);
        }
    
        // 2. Szene wechseln
        if(choice.next){
            currentScene = typeof choice.next === 'function' ? choice.next() : choice.next;
            localStorage.setItem(saveKey, currentScene);
            showScene();
        } else {
            typeText(sceneText, "Danke f√ºrs Spielen! üå∏", 40);
            choicesDiv.innerHTML = `<button onclick="location.reload()">Zur√ºck zum Hauptmen√º</button>`;
            localStorage.removeItem(saveKey); 
        }
      };
      choicesDiv.appendChild(btn);
    });
    // Dritter Button: Zur√ºck zum Hauptmen√º
    const menuBtn = document.createElement('button');
    menuBtn.innerText = "Hauptmen√º";
    menuBtn.onclick = function(){
        document.getElementById('gameContainer').style.display = 'none';
        document.getElementById('mainMenu').style.display = 'flex';
    };
    choicesDiv.appendChild(menuBtn);
    choicesDiv.style.visibility = 'visible';
  });
}

function getLastActScene() {
  if (sceneHistory.length === 0) return null;
  return sceneHistory[sceneHistory.length - 1];
}

/********* FIREBASE CONFIG *********/
const firebaseConfig = {
  apiKey: "AIzaSyD_cDHNMZZiLuGLfAntYAc8ONtKgwYlp9Y",
  authDomain: "luisaglobalchat.firebaseapp.com",
  projectId: "luisaglobalchat",
  storageBucket: "luisaglobalchat.appspot.com",
  messagingSenderId: "1029281753779",
  appId: "1:1029281753779:web:c266b6b0ef66a977999ec6"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const chatCollection = db.collection('chatMessages');
// Jedes Ger√§t bekommt eine eigene ID
let deviceId = localStorage.getItem('luisaDeviceId');
if (!deviceId) {
    deviceId = 'device_' + Math.random().toString(36).substr(2,9);
    localStorage.setItem('luisaDeviceId', deviceId);
}
// Inventar/Entscheidungen pro Device
const inventoryCollection = db.collection('inventories');
const inventoryDoc = inventoryCollection.doc(deviceId);

// Speichert eine Entscheidung ins Inventar
function saveDecision(decisionKey){
    inventoryDoc.set({
        displayName: displayName,
        decisions: firebase.firestore.FieldValue.arrayUnion(decisionKey)
    }, { merge: true });
}

const startCollection = db.collection('appStarts');
const startDoc = startCollection.doc(deviceId);

/********* ACTIVITY TRACKING *********/
const activitiesCollection = db.collection('activities');
const activitiesDoc = activitiesCollection.doc(deviceId);

// Hilfsfunktion zum Z√§hlen
function logActivity(actionKey){
  activitiesDoc.set({
    displayName: displayName,
    [actionKey]: firebase.firestore.FieldValue.increment(1),
    lastAction: firebase.firestore.FieldValue.serverTimestamp()
  }, { merge: true });
}

/********* CHAT FUNKTIONEN *********/
// Chat √∂ffnen
document.getElementById('openChatBtn').onclick = function() {
  logActivity('openChat');

  document.getElementById('mainMenu').style.display = 'none';
  document.getElementById('gameContainer').style.display = 'none';
  document.getElementById('chatContainer').style.display = 'flex';
  loadChat();
};

// Chat schlie√üen
document.getElementById('backFromChatBtn').onclick = function() {
  document.getElementById('chatContainer').style.display = 'none';
  document.getElementById('mainMenu').style.display = 'flex';
};

// Nachricht abschicken
document.getElementById('sendChatBtn').onclick = function() {
    const msg = document.getElementById('chatInput').value.trim();
    if(msg === '') return;

    chatCollection.add({
        text: msg,
        sender: deviceId,
        displayName: displayName,  // Alles vom aktuellen Ger√§t ist "blau"
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    document.getElementById('chatInput').value = '';
};

// Nachrichten live laden
function loadChat() {
  const chatMessages = document.getElementById('chatMessages');
  chatMessages.innerHTML = '';
  chatCollection.orderBy('timestamp', 'asc').onSnapshot(snapshot => {
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.innerHTML = ''; // clear
    snapshot.forEach(doc => {
      addMessage(doc.data());
    });
  });
}
function addMessage(msgData) {
    const chatMessages = document.getElementById('chatMessages');
    const div = document.createElement('div');

    // Alles vom aktuellen Ger√§t = blau, alles andere = pink
    if(msgData.sender === deviceId){
        div.className = 'myMessage';
    } else {
        div.className = 'theirMessage';
    }

    div.innerText = msgData.text;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

/********* START INTRO *********/
document.getElementById('startBtn').onclick = async () => {
  // Musik starten
  music.play().catch(() => {});
  music.volume = 0.6;

  // Display Name initialisieren
  await initDisplayName();

  // Nachdem displayName geladen/abgefragt wurde:
document.getElementById('commentLabel').innerText = `Guten Morgen, ${displayName}`;

  // Firestore Start z√§hlen
  await startDoc.set({
    deviceId: deviceId,
    displayName: displayName,
    startCount: firebase.firestore.FieldValue.increment(1),
    lastStart: firebase.firestore.FieldValue.serverTimestamp()
  }, { merge: true });

  // Overlay ausblenden
  const overlay = document.getElementById('startOverlay');
  overlay.style.opacity = '0';
  setTimeout(() => overlay.remove(), 800);
};

/********* GLOBAL BUTTON CLICK SOUND *********/
document.addEventListener('click', (e) => {
  const btn = e.target.closest('button');
  if (!btn) return;

  clickSound.currentTime = 0;
  clickSound.play().catch(() => {});
});

</script>
</body>
</html>
