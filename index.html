<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>F√ºr Luisa üå∏</title>

<style>
/* ===== BESTEHENDES DESIGN BLEIBT ===== */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'Georgia', serif;
  color: #f5f5f5;
  background: radial-gradient(circle at top, #0a0a0a, #1a1a2e);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

h1,h2{
  color:#ffd700;
  text-shadow:0 0 10px #ffd700,0 0 20px #ffb347;
  text-align:center;
}

h1{font-size:3em;}
h2{font-size:2.5em;}

#mainMenu{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:25px;
}

#mainMenu button{
  background:linear-gradient(145deg,#6655aa,#444477);
  border:none;
  padding:20px 40px;
  border-radius:15px;
  color:#ffd700;
  font-size:22px;
  font-weight:bold;
  cursor:pointer;
}

#mainMenu button:hover{
  transform:scale(1.08);
}

/* ===== MEMORY GAME ===== */
#memoryContainer{
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  flex:1;
}

#scoreDisplay{
  font-size:28px;
  margin-bottom:20px;
  color:#ffdd77;
  text-shadow:0 0 10px gold;
}

#grid{
  display:grid;
  grid-template-columns:repeat(3,120px);
  grid-gap:20px;
}

.memoryBtn{
  width:120px;
  height:120px;
  border-radius:15px;
  border:none;
  background:#444477;
  box-shadow:0 0 15px rgba(255,215,0,0.3);
  cursor:pointer;
  transition:0.2s;
}

.memoryBtn.active{
  background:#ffd700;
  box-shadow:0 0 30px gold;
}

#leaderboardContainer{
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  flex:1;
  width:100%;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>

<h1>F√ºr Luisa üå∏</h1>
<h2>Fr4gm3nt3</h2>

<div id="mainMenu">
  <button id="playBtn">Spielen</button>
  <button id="leaderboardBtn">Leaderboard</button>
  <button id="openChatBtn">Deine Gedanken</button>
</div>

<!-- MEMORY GAME -->
<div id="memoryContainer">
  <div id="scoreDisplay">Score: 0</div>
  <div id="grid"></div>
</div>

<!-- LEADERBOARD -->
<div id="leaderboardContainer">
  <h2>Global Leaderboard üåç</h2>
  <div id="leaderboardList"></div>
  <button onclick="backToMenu()">Zur√ºck</button>
</div>

<audio id="clickSound" src="magic-button-click.mp3" preload="auto"></audio>

<script>

/* ===== FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyD...",
  authDomain: "luisaglobalchat.firebaseapp.com",
  projectId: "luisaglobalchat"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let deviceId = localStorage.getItem('luisaDeviceId');
if(!deviceId){
  deviceId = 'device_' + Math.random().toString(36).substr(2,9);
  localStorage.setItem('luisaDeviceId',deviceId);
}

const leaderboardCollection = db.collection('memoryLeaderboard');

/* ===== MEMORY GAME LOGIC ===== */
const grid = document.getElementById("grid");
const scoreDisplay = document.getElementById("scoreDisplay");
let sequence = [];
let playerIndex = 0;
let score = 0;
let acceptingInput = false;

for(let i=0;i<9;i++){
  const btn = document.createElement("button");
  btn.className="memoryBtn";
  btn.dataset.index=i;
  btn.onclick=()=>handlePlayerInput(i);
  grid.appendChild(btn);
}

function startGame(){
  sequence=[];
  score=0;
  nextRound();
}

function nextRound(){
  acceptingInput=false;
  playerIndex=0;
  sequence.push(Math.floor(Math.random()*9));
  scoreDisplay.innerText="Score: "+score;
  playSequence();
}

function playSequence(){
  let i=0;
  const buttons=document.querySelectorAll(".memoryBtn");
  const interval=setInterval(()=>{
    buttons[sequence[i]].classList.add("active");
    setTimeout(()=>{
      buttons[sequence[i]].classList.remove("active");
    },400);
    i++;
    if(i>=sequence.length){
      clearInterval(interval);
      setTimeout(()=>acceptingInput=true,500);
    }
  },600);
}

function handlePlayerInput(index){
  if(!acceptingInput)return;

  if(index===sequence[playerIndex]){
    playerIndex++;
    if(playerIndex===sequence.length){
      score++;
      nextRound();
    }
  }else{
    gameOver();
  }
}

function gameOver(){
  saveHighscore(score);
  alert("Game Over! Score: "+score);
  backToMenu();
}

function saveHighscore(score){
  leaderboardCollection.doc(deviceId).set({
    deviceId:deviceId,
    highscore:firebase.firestore.FieldValue.increment(0),
    best:score
  },{merge:true});
}

/* ===== LEADERBOARD ===== */
function loadLeaderboard(){
  document.getElementById("leaderboardList").innerHTML="";
  leaderboardCollection.orderBy("best","desc").limit(20)
  .get().then(snapshot=>{
    snapshot.forEach(doc=>{
      const data=doc.data();
      const div=document.createElement("div");
      div.innerText=data.deviceId+" ‚Äî "+data.best;
      document.getElementById("leaderboardList").appendChild(div);
    });
  });
}

/* ===== NAVIGATION ===== */
document.getElementById("playBtn").onclick=()=>{
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("memoryContainer").style.display="flex";
  startGame();
};

document.getElementById("leaderboardBtn").onclick=()=>{
  document.getElementById("mainMenu").style.display="none";
  document.getElementById("leaderboardContainer").style.display="flex";
  loadLeaderboard();
};

function backToMenu(){
  document.getElementById("memoryContainer").style.display="none";
  document.getElementById("leaderboardContainer").style.display="none";
  document.getElementById("mainMenu").style.display="flex";
}

/* GLOBAL CLICK SOUND */
document.addEventListener('click', (e)=>{
  const btn=e.target.closest('button');
  if(!btn)return;
  const clickSound=document.getElementById('clickSound');
  clickSound.currentTime=0;
  clickSound.play().catch(()=>{});
});

</script>
</body>
</html>

