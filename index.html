<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>F√ºr Luisa üå∏</title>
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'Georgia', serif;
  color: #f5f5f5;
  background: radial-gradient(circle at top, #0a0a0a, #1a1a2e); 
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* Gl√ºhender Titel */
h1 { 
  color: #ffd700; 
  text-shadow: 0 0 10px #ffd700, 0 0 20px #ffb347;
  font-size: 3em;
  margin-bottom: 50px;
  text-align: center;
}
h2 { 
  color: #ffd700; 
  text-shadow: 0 0 10px #ffd700, 0 0 20px #ffb347;
  font-size: 2.5em;
  margin-bottom: 16px;
  text-align: center;
}

/* Hauptmen√º */
#mainMenu {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 25px;
}
#mainMenu button { 
  background: linear-gradient(145deg, #6655aa, #444477);
  border: none;
  padding: 20px 40px;
  border-radius: 15px;
  color: #ffd700;
  font-size: 22px;
  font-weight: bold;
  cursor: pointer;
  text-shadow: 0 0 5px #ffd700;
  transition: transform 0.15s, background 0.2s;
}
#mainMenu button:hover { 
  background: linear-gradient(145deg, #7777cc, #5555aa); 
  transform: scale(1.08);
}

/* Spielcontainer */
#gameContainer {
  flex: 1;
  display: none; /* wird erst sichtbar beim Spielstart */
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}

/* Akt / Szene Label */
#sceneLabel {
  font-size: 24px;
  margin-bottom: 20px;
  color: #ffdd77;
  text-shadow: 0 0 5px #ffd700;
}

/* Textbox */
#sceneText {
  display: none; /* erst sichtbar, wenn Animation startet */
  margin: 20px auto; 
  max-width: 80%;
  padding: 30px; 
  background: rgba(30,30,50,0.85); 
  border-radius: 15px; 
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); 
  font-size: 20px; 
  min-height: 180px;
  white-space: pre-wrap;
}

/* Buttons nebeneinander unten */
#choices {
  display: flex;
  justify-content: center;
  margin-top: 30px;
  gap: 20px;
  visibility: hidden; /* erst nach Tippen sichtbar */
}
#choices button { 
  flex: 1 1 150px;
  max-width: 250px;
  padding: 15px 0;
  border-radius: 12px;
  background: #444477; 
  color: #ffd700; 
  font-weight: bold;
  font-size: 18px;
  border: none;
  cursor: pointer;
  transition: transform 0.1s, background 0.2s;
}
#choices button:hover { background:#6655aa; transform: scale(1.05); }

/* Sterne mit leichter Bewegung */
.star {
  position: absolute;
  width: 2px; 
  height: 2px; 
  background: white; 
  border-radius: 50%;
  opacity: 0.8;
  animation: twinkle 2s infinite alternate, floatStars 6s infinite alternate;
}
@keyframes twinkle { 0% {opacity:0.3;} 100% {opacity:1;} }
@keyframes floatStars {
  0% { transform: translate(0px,0px);}
  50% { transform: translate(1.5px, -1.5px);}
  100% { transform: translate(0px,0px);}
}

/* Chat-UI */
#chatContainer {
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  width:80%;
  max-width:600px;
  margin:0 auto;
  background: rgba(30,30,50,0.85);
  border-radius:15px;
  padding:20px;
  min-height:400px;
}
#chatMessages {
  flex:1;
  overflow-y:auto;
  width:100%;
  margin-bottom:10px;
  color:#ff77cc;
}
.myMessage {
  background-color: #0099ff;  /* blau f√ºr dich */
  color: white;
  padding: 8px 12px;
  border-radius: 12px;
  margin: 5px 0;
  align-self: flex-end;
  max-width: 80%;
  word-wrap: break-word;
}
.theirMessage {
  background-color: #ff77cc;  /* pink f√ºr sie */
  color: white;
  padding: 8px 12px;
  border-radius: 12px;
  margin: 5px 0;
  align-self: flex-start;
  max-width: 80%;
  word-wrap: break-word;
}
#chatInput {
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:16px;
}
#chatContainer button {
  margin-top:10px;
  padding:10px 20px;
  border-radius:8px;
  border:none;
  background:#444477;
  color:#ffd700;
  font-weight:bold;
  cursor:pointer;
}
#chatContainer button#backFromChatBtn { background:#6655aa; }
</style>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>

<h1>F√ºr Luisa üå∏</h1>
<h2>Titel</h2>

<!-- Hauptmen√º -->
<div id="mainMenu">
  <button id="newGameBtn">Neuer Spielstand</button>
  <button id="loadGameBtn">Spielstand laden</button>
  <button id="openChatBtn">Deine Gedanken</button>
</div>

<!-- Spielbereich -->
<div id="gameContainer">
  <div id="sceneLabel"></div>
  <div id="sceneText"></div>
  <div id="choices"></div>
</div>

<!-- Chatbereich -->
<div id="chatContainer">
  <h2>Deine Gedanken üåù</h2>
  <div id="chatMessages"></div>
  <input id="chatInput" type="text" placeholder="Schreibe etwas..." />
  <button id="sendChatBtn">Abschicken</button>
  <button id="backFromChatBtn">Zur√ºck</button>
</div>

<audio id="bgMusic" src="momedeiros88-mystical.mp3" type="audio/mpeg" loop></audio>
<audio id="typeSound" src="game-text.mp3" preload="auto"></audio>

<script>
/********* STERNE GENERIEREN *********/
for(let i=0;i<80;i++){
  const star = document.createElement('div');
  star.className = 'star';
  star.style.top = Math.random()*100+'%';
  star.style.left = Math.random()*100+'%';
  star.style.width = star.style.height = (Math.random()*2+1)+'px';
  star.style.animationDuration = (Math.random()*2+1)+'s, '+(4+Math.random()*3)+'s';
  document.body.appendChild(star);
}

/********* STORY DATA *********/
const story = {
    "0_0": { label:"Akt 0, Szene 0", text:"Du h√§lst inne. Vielleicht ist es besser so, du l√§sst den Beh√§lter hier stehen. Vielleicht ist heute nicht der Tag f√ºr Geheimnisse. Der Fahrradkeller ist leer, es riecht nach Beton und kalter Luft. Du schlie√üt deine Jacke. Bis auf den Beh√§lter wirkt alles normal. Du schiebst dein Fahrrad hinaus. Die T√ºr f√§llt hinter dir zu.  Der Abend empf√§ngt dich als w√§re nichts gewesen. Die Stra√üen sind still. Und du f√§hrst nach Hause...", choices:[{ text:"Zur√ºck zum Anfang", next:"1_1" },{ text:"Spiel beenden", next:null}] },
    "1_1": { label:"Akt 1, Szene 1", text:"DER KELLER. Der letzte Schultag vor den Ferien h√§tte leicht sein sollen. Aber irgendetwas hat den Tag in die L√§nge gezogen. Stunden, die sich gezogen haben wie Kaugummi. Als du endlich aus dem Klassenzimmer trittst, ist es schon Abend. Du gehst die Treppen hinunter in den Fahrradkeller. Deine Schritte hallen. Du bist allein. Du willst einfach nur nach Hause. Doch dann h√§lst du inne. In deinem Flaschenhalter steckt etwas, das dort nicht hingeh√∂rt. Ein kleiner Beh√§lter aus durchsichtigem Material. Du bist dir sicher: Der war heute Morgen nicht da. Du gehst einen Schritt n√§her. Dann noch einen. Der Beh√§lter leuchtet schwach, ein warmes, pulsierendes Schimmern, das sich gegen die kalte Kellerluft stemmt. F√ºr einen Moment h√∂rst du nur deinen eigenen Atem. Was tust du, Luisa?", choices:[{ text:"Ich lasse ihn in Ruhe.", next:"0_0" },{ text:"Ich schaue ihn mir genauer an.", next:"1_2" }] },
    "1_2": { label:"Akt 1, Szene 2", text:"DER BEH√ÑLTER. Du gehst n√§her an dein Fahrrad heran. Der Beh√§lter sitzt fest im Flaschenhalter, als h√§tte ihn jemand mit Absicht dort platziert. Aus der N√§he wirkt er noch ungew√∂hnlicher: glatt, schwerer als Glas, aber ohne Kratzer, ohne Etikett, ohne jede Spur von Herkunft. Das Licht im Inneren pulsiert langsam. Warm. Ruhig. Fast wie ein Herzschlag. Du legst die Fingerspitzen an die Oberfl√§che. Der Beh√§lter reagiert. Ein leiser Schimmer wandert unter deiner Ber√ºhrung entlang, als w√ºrde er dich erkennen. F√ºr einen Moment wird der Keller heller. Dann wird es wieder still. Der Beh√§lter liegt schwer in deiner Hand. Und das Licht darin wartet. Was tust du, Luisa?", choices:[{ text:"Ich lege ihn zur√ºck.", next:"0_0" },{ text:"Ich √∂ffne ihn.", next:"1_3" }] },
    "1_3": { label:"Akt 1, Szene 3", text:"DAS LICHT. Du √∂ffnest den Beh√§lter. Ein warmer Hauch entweicht. Du siehst hinein. Im Inneren des Beh√§lters liegt kein Gegenstand im klassischen Sinn. Es ist eher... ein Zustand. Ein Fragment aus Licht, das sich nicht an die Regeln der Welt h√§lt. Es hat keine feste Form. Manchmal wirkt es wie ein kleiner Splitter, manchmal wie ein Tropfen, manchmal wie ein winziger Nebelwirbel aus Helligkeit. Es leuchtet nicht stark. Es glimmt. Warm. Ruhig. In einem Rhythmus. Wenn man genauer hinsieht, erkennt man feine Linien im Licht. Wie winzige Sternbahnen, die sich umeinander drehen. Nicht chaotisch, sondern harmonisch, wie ein kleines Universum im Glas. Das Licht ist nicht hei√ü. Es ist nicht kalt. Und manchmal, wenn man es aus dem Augenwinkel betrachtet, scheint es sich zu bewegen, als w√ºrde es auf etwas reagieren. Oder auf jemanden. Was tust du, Luisa?", choices:[{ text:"Ich schlie√üe den Beh√§lter wieder.", next:"0_0" },{ text:"Ich greife nach dem Licht.", next:"1_4" }] },
    "1_4": { label:"Akt 1, Szene 4", text:"DER √úBERGANG. Du h√§lst den Beh√§lter in der Hand. Das Licht darin pulsiert. Du atmest ein. Du greifst nach dem Licht. F√ºr einen Augenblick sp√ºrst du nichts. Nur W√§rme. Nur Stille. Dann passiert alles gleichzeitig. Das Licht schie√üt nach oben, umh√ºllt deine Hand, zieht sich an dir fest wie ein Faden aus Energie - und die Welt unter deinen F√º√üen bricht weg. Der Fahrradkeller l√∂st sich auf. Die K√§lte verschwindet. Die Ger√§usche verschwinden. Du wirst nicht gesto√üen, nicht gezogen - du wirst √ºbergeben. Du schwebst. Um dich herum √∂ffnet sich ein Raum aus Sternen. Langsam, weit, still. Als w√ºrdest du durch ein Universum gleiten, das gerade erst beschlossen hat, zu existieren. Vor dir entsteht ein Lichtpunkt. Er w√§chst. Er wird zu einer Form. Zu einem H√ºgel. Gras, so gr√ºn, dass es fast leuchtet. Ein Wind, den du nicht sp√ºrst, bewegt die Halme. Auf dem H√ºgel steht ein Tisch. Zwei St√ºhle. Auf einem der St√ºhle sitzt jemand. Du kannst die Person sehen. Die Umrisse. Die Haltung. Die Pr√§senz. Aber jedes Mal, wenn du versuchst, das Gesicht zu erkennen, verwischt es. Etwas in dir sagt dir, dass du diese Person kennen solltest. Dass du sie vielleicht sogar kennst. Aber die Welt l√§sst es nicht zu. Noch nicht. Die Figur sitzt ruhig da. Wartend. Nicht bedrohlich. Nicht einladend. Einfach... da. Was tust du, Luisa?", choices:[{ text:"Ich gehe zu der Person.", next:"1_5" },{ text:"Ich laufe von der Person weg.", next:"1_6" }] },
    "1_6": { label:"Akt 1, Szene 6", text:"DER RAND. Etwas in dir zieht sich zusammen. Kein klarer Gedanke, eher ein Instinkt. Ein Gef√ºhl. Zu viel. Zu fremd. Dein K√∂rper entscheidet schneller als dein Kopf. Du rennst. Der H√ºgel bleibt hinter dir zur√ºck, der Tisch, die zwei St√ºhle, die verschwommene Gestalt, deren Gesicht du nicht erkennen kannst. Das Gras unter deinen F√º√üen gibt leicht nach, als w√ºrde es dich nicht wirklich ber√ºhren. Die Welt um dich herum bleibt still, zu still, w√§hrend du weiterl√§ufst. Und weiter. Und weiter. Bis die Welt pl√∂tzlich endet. Vor dir f√§llt der Boden einfach ab. Kein Abhang. Kein √úbergang. Nur ein scharfer Schnitt als h√§tte jemand die Welt ausgeschnitten und in den Weltraum gelegt. Unter dir breitet sich ein Meer aus Sternen aus. Lebendig. Bewegend. Unendlich. Hinter dir der H√ºgel. Vor die liegt das Nichts. Was tust du, Luisa?", choices:[{ text:"Ich springe.", next:"0_0" },{ text:"Ich kehre um.", next:"1_5" }] },
    "1_5": { label:"Akt 1, Szene 5", text:"DER TISCH. Du gehst den H√ºgel hinauf. Der Tisch steht dort, schlicht, aus hellem Holz. Zwei St√ºhle. Einer davon ist besetzt. Die Gestalt sitzt ruhig da. Du kannst die Umrisse klar erkennen - Schultern, H√§nde, Haltung. Aber jedes Mal, wenn dein Blick das Gesicht erreichen will, verwischt es, als w√ºrde die Welt selbst eine Grenze ziehen. Du setzt dich. Der Stuhl ist warm, obwohl hier keine Sonne scheint. Du beginnst das Gespr√§ch. Es f√ºhlt sich richtig an, als h√§ttest du schon mit dieser Person gesprochen. Die Gestalt neigt leicht den Kopf. Dann antwortet sie. Nicht laut, nicht mit klaren Worten, eher wie ein Gedanke, der sich in dir formt. Du nimmst wahr, dass sie sich Creator nennt. Dass sie dich erwartet hat. W√§hrend sie weiter spricht, sp√ºrst du etwas, das du nicht einordnen kannst. Ein Eindruck, dass der Creator etwas in dir f√ºhlt, etwas, das ihn irritiert, fasziniert, anzieht - ohne dass er es benennt. Dann ver√§ndert sich die Stimmung. Nicht bedrohlich, eher wie ein leiser √úbergang. Der Creator spricht von einer Aufgabe. Nicht als Befehl, nicht als Pr√ºfung, sondern als M√∂glichkeit. Etwas, das du tun k√∂nntest, wenn du willst. Du sp√ºrst, dass die Entscheidung bei dir liegt. Der Tisch wirkt pl√∂tzlich wie eine Schwelle. Ein Anfang. Die Frage steht im Raum, klar, ruhig, unausgesprochen: Bist du bereit, diese Mission anzunehmen, Luisa?", choices:[{ text:"Ich lehne ab.", next:"0_0" },{ text:"Ich akzeptiere die Mission.", next:"1_7" }] },
    "1_9": { label:"Akt 1, Szene 1", text:"", choices:[{ text:"Ich lege ihn zur√ºck.", next:"0_0" },{ text:"Ich √∂ffne ihn.", next:"1_3" }] },
};

/********* LOCAL STORAGE *********/
const saveKey = 'luisaStorySave';
let currentScene = null;

/********* HINTERGRUNDMUSIK UND TIPPSOUND *********/
const music = document.getElementById('bgMusic');
music.volume = 0.4;
const typeSound = document.getElementById('typeSound');
typeSound.volume = 0.15;

function stopTypeSound() {
  const fade = setInterval(() => {
    if (typeSound.volume > 0.02) {
      typeSound.volume -= 0.02;
    } else {
      clearInterval(fade);
      typeSound.pause();
      typeSound.currentTime = 0;
      typeSound.volume = 0.15;
    }
  }, 20);
}

function typeText(element, text, speed = 40, callback = null) {
  element.innerText = '';
  let i = 0;
  let typingActive = true;

  function typing() {
    if (!typingActive) { stopTypeSound(); return; }

    if (i < text.length) {
      element.innerText += text[i];

      if (text[i] !== ' ' && Math.random() < 0.35) {
        typeSound.currentTime = 0;
        typeSound.play().catch(() => {});
      }

      i++;
      setTimeout(typing, speed);
    } else {
      stopTypeSound();
      typingActive = false;
      if (callback) callback();
    }
  }
  typing();

  return () => { typingActive = false; stopTypeSound(); };
}

/********* HAUPTMEN√ú BUTTONS *********/
document.getElementById('newGameBtn').onclick = function() {
  currentScene = "1_1";
  localStorage.setItem(saveKey, currentScene);
  showGame();
  music.play().catch(e => console.log(e));
}

document.getElementById('loadGameBtn').onclick = function() {
  const saved = localStorage.getItem(saveKey);
  if(saved && story[saved]){
    currentScene = saved;
    showGame();
    music.play().catch(e => console.log(e));
  } else { alert("Kein gespeicherter Spielstand gefunden."); }
}

/********* SPIEL ANZEIGEN *********/
function showGame(){
  document.getElementById('mainMenu').style.display = 'none';
  document.getElementById('chatContainer').style.display = 'none';
  document.getElementById('gameContainer').style.display = 'flex';
  showScene();
}

/********* SZENE ANZEIGEN *********/
function showScene(){
  const scene = story[currentScene];
  if(!scene) return;

  const sceneText = document.getElementById('sceneText');
  const choicesDiv = document.getElementById('choices');
  document.getElementById('sceneLabel').innerText = scene.label;

  sceneText.style.display = 'block';
  choicesDiv.style.visibility = 'hidden';

  typeText(sceneText, scene.text, 40, () => {
    choicesDiv.innerHTML = '';
    scene.choices.forEach(choice => {
      const btn = document.createElement('button');
      btn.innerText = choice.text;
      btn.onclick = function(){
        if(choice.next){
          currentScene = choice.next;
          localStorage.setItem(saveKey, currentScene);
          showScene();
        } else {
          typeText(sceneText, "Danke f√ºrs Spielen! üå∏", 40);
          choicesDiv.innerHTML = `<button onclick="location.reload()">Zur√ºck zum Hauptmen√º</button>`;
          localStorage.removeItem(saveKey); 
        }
      };
      choicesDiv.appendChild(btn);
    });
    choicesDiv.style.visibility = 'visible';
  });
}

/********* FIREBASE CONFIG *********/
const firebaseConfig = {
  apiKey: "AIzaSyD_cDHNMZZiLuGLfAntYAc8ONtKgwYlp9Y",
  authDomain: "luisaglobalchat.firebaseapp.com",
  projectId: "luisaglobalchat",
  storageBucket: "luisaglobalchat.appspot.com",
  messagingSenderId: "1029281753779",
  appId: "1:1029281753779:web:c266b6b0ef66a977999ec6"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const chatCollection = db.collection('chatMessages');

/********* CHAT FUNKTIONEN *********/
// Chat √∂ffnen
document.getElementById('openChatBtn').onclick = function() {
  document.getElementById('mainMenu').style.display = 'none';
  document.getElementById('gameContainer').style.display = 'none';
  document.getElementById('chatContainer').style.display = 'flex';
  loadChat();
};

// Chat schlie√üen
document.getElementById('backFromChatBtn').onclick = function() {
  document.getElementById('chatContainer').style.display = 'none';
  document.getElementById('mainMenu').style.display = 'flex';
};

// Nachricht abschicken
document.getElementById('sendChatBtn').onclick = function() {
  const msg = document.getElementById('chatInput').value.trim();
  if(msg === '') return;
  chatCollection.add({
    text: msg,
    sender: 'me',   // üîπ markiert als eigene Nachricht
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById('chatInput').value = '';
};

// Nachrichten live laden
function loadChat() {
  const chatMessages = document.getElementById('chatMessages');
  chatMessages.innerHTML = '';
  chatCollection.orderBy('timestamp', 'asc').onSnapshot(snapshot => {
    chatMessages.innerHTML = '';
    snapshot.forEach(doc => {
      addMessage(doc.data()); // üîπ hier wird jetzt die Farbe automatisch gesetzt
    });
  });
}

function addMessage(msgData) {
  const chatWindow = document.getElementById('chatMessages');
  const msgDiv = document.createElement('div');

  // Pr√ºfen, ob die Nachricht von dir kommt oder nicht
  if(msgData.sender === 'me') {
    msgDiv.className = 'myMessage';
  } else {
    msgDiv.className = 'theirMessage';
  }

  msgDiv.innerText = msgData.text;
  chatWindow.appendChild(msgDiv);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}
</script>
</body>
</html>



